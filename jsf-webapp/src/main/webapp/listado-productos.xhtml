<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"   
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions"
      >
	<h:head>
		<title>LOGIN-SUCCESS.XHTML</title>
<!-- 	<h:outputScript library="javax.faces" name="jsf.js" target="body" /> -->
		<h:outputStylesheet library="webjars" name="/bootstrap/4.3.1/css/bootstrap.min-jsf.css" />
		<h:outputStylesheet name="primeicons/primeicons.css" library="primefaces" />
	</h:head>
	<h:body>
	    <p:growl id="msgs" showDetail="true"/>
		<div class="container">
			<div class="row">
				<div class="col-12 mt-2">
					<h:form id="form">
					    <p:dataTable 
					    	id="producto" 
					    	var="producto" 
					    	value="#{productoBean.productos}" 
					    	editable="true"
 							rowKey="#{producto.id}"
                 			selection="#{productoBean.producto}"
                			selectionMode="single"
					    	>
					        <f:facet name="header">
					           Listado de productos
					        </f:facet>

					        <p:ajax event="rowEdit" listener="#{productoBean.onRowEdit}" update="msgs"/>
					        <p:ajax event="rowEditCancel" listener="#{productoBean.onRowCancel}" update="msgs" />
					        <p:ajax event="rowSelect" listener="#{productoBean.onRowSelect}"/>
					 		<p:ajax event="cellEdit" listener="#{productoBean.onCellEdit}" update="msgs" />
					 		
					        <p:column headerText="ID">
						        <h:outputText value="#{producto.id}" />
						    </p:column>

							<p:column headerText="Codigo">
						        <h:outputText value="#{producto.codigo}" />
						    </p:column>
						    
					        <p:column headerText="Descripcion">
					            <p:cellEditor>
									<f:facet name="output"><h:outputText value="#{producto.descripcion}" /></f:facet>
					                <f:facet name="input"><p:inputText value="#{producto.descripcion}" style="width:100%"/></f:facet>
					            </p:cellEditor>
					        </p:column>
					 
					        <p:column headerText="Precio">
					            <p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{producto.precio}" >
											<f:convertNumber pattern="$ ##,###.00"/>
										</h:outputText>
									</f:facet>
					                <f:facet name="input">
					                	<p:inputText value="#{producto.precio}" style="width:100%"/>
					                </f:facet>
					            </p:cellEditor>
					        </p:column>
					 
					 		<p:column headerText="Tipo Producto">
					            <p:cellEditor>
					                <f:facet name="output">
					                	<h:outputText value="#{producto.tipoProducto.descripcion}"/>
					                </f:facet>
					                <f:facet name="input">
							            <p:selectOneMenu id="tipoProducto" value="#{productoBean.tipoProducto}" style="width:100%">
							                <f:selectItems var="tipoProducto"
							                	value="#{tipoProductoBean.tipoProductos}" 
							                	itemLabel="#{tipoProducto.descripcion}" 
							                	itemValue="#{tipoProducto.id}">
							                </f:selectItems>
							            </p:selectOneMenu>
					                </f:facet>
					            </p:cellEditor>
					        </p:column>
					        <p:column style="width:35px">
					            <p:rowEditor />
					        </p:column>
				        
				          	<f:facet name="footer">
					        	Hay en total #{fn:length(productoBean.productos)} productos.
					        </f:facet>	
					    </p:dataTable>
					    
					     <p:contextMenu for="producto">
					        <p:menuitem value="Eliminar" update="producto msgs" icon="pi pi-times" action="#{productoBean.eliminarProducto}"/>
					    </p:contextMenu>
					    
					</h:form>			
				</div>
				<p:separator/>
				<div class="col-12 text-center">
					<h:form>				
						<h:commandButton 
							action="nuevo-producto.xhtml?faces-redirect=true"
						 	value="Nuevo" 
						 	class="btn btn-primary">
						</h:commandButton>							
						<h:commandButton 
							action="login-success.xhtml?faces-redirect=true" 
							value="Volver" 
							styleClass="btn btn-secondary ml-2"/>
					</h:form>
				</div>
			</div>
		</div>
	</h:body>
</html>